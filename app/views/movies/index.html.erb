<p id="notice"><%= notice %></p>


<table class="table table-striped">
  <tbody>
    <% @movies.each_with_index do |movie,index| %>
      <tr>
        <th><%= index + 1 + (@movies.current_page - 1) * @movies.count  %></th>
        <td><%= link_to movie.title, movie %></td>
        <td><%= movie.text %></td>
        <td><%= movie.category.capitalize %></td>
        <td><%= link_to 'Edit', edit_movie_path(movie) %></td>
        <td><%= link_to 'Destroy', movie, method: :delete, data: { confirm: 'Are you sure?' } %></td> 
        <td>
          <%= button_to 'Rate',
          rate_path(:id => movie.id),{ 
            local:false,
            class:"btn btn-secondary",
            'data-bs-toggle'=>"modal",
            'data-bs-target'=>"#exampleModal"
          }%>
        </td>   
      </tr>
    <% end %>
  </tbody>
  <%= paginate @movies %>
</table>

<%= form_with url: "/", method: :get do |form| %>
  <%= form.label :category, "Filter by category:" %>
  <%= select_tag :category,
      options_for_select(@category, params[:category]),
      :onchange => "window.location.replace('/movies/category/'+this.value);" %>
<% end %>

<br>

<%= link_to 'New Movie', new_movie_path %>






<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <%= form_with url: "/",local: false do |u|%> 
        <div class="modal-header">
          <div id="star"></div>
          <%= u.hidden_field :id, :value => :id%>
          <%= u.submit 'Rate!',class:"btn btn-outline-secondary"%>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Close</button>
        </div>
      <%end%>  
    </div>
  </div>
</div>



<script>
  $('#star').raty({ 
    starOff:  '<%= asset_path('star-off.png') %>',
    starOn : '<%= asset_path('star-on.png') %>',
    number: 10,
    click: function(score) {
        console.log(score)
    }
  });
</script>
